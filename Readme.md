# Social Travel

Проектирование социальной сети для путешественников в рамках курса по System Design.

## Сбор требований

### Функциональные требования

Описание функциональности от бизнеса:

- публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- оценка и комментарии постов других путешественников;
- подписка на других путешественников, чтобы следить за их активностью;
- поиск популярных мест для путешествий и просмотр постов с этих мест;
- просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;

### Нефункциональные требования

- География пользователей: страны СНГ, не планируем работать в других регионах
- Общее количество пользователей в течение года: 10_000_000.
  Планируется дальнейший рост количества пользователей.
- Используемые платформы:
  - Мобильные устройства
  - Браузер
- "Очень надежная" система (SLO = 99.99%)
  -> 52м 36с недоступность в год
- Сезонность: присутствует, летом и зимой. (множитель х2)
- Места для путешествий: ограничены
- Лента постов: бесконечная, подгружаем по 10 постов
- Поиск популярных мест: раз в день делать ТОП-100 мест (ночью, когда нагрузка уменьшается)

Показатели:

Показатели | Среднее | Максимальное
-------|-----|-----
Пользователей в сутки (DAU) | - | 1_000_000
Постов в сутки у пользователя | 1 | 10
Фотографий в посте | 1 | 10
Размер фотографии в посте | 2Мб | 5Мб
Символов в описании | 100 | 500
Подписчиков | 500 | 1_000_000
Оценок поста в день | 10 | 100_000
Оценок поста всего | 100 | 1_000_000
Комментариев к посту в день | 5 | 1000
Комментариев к посту | 10 | 10_000
Мест для путешествий | - | 10_000
Запросов популярных мест в день 1 пользователем | 1 | 10
Запросов к ленте пользователя | 1 | 10
Постов на странице в ленте | - | 10

#### Ограничения

- Время хранения постов: навсегда
- Удаление неактивных пользователей: через год
- Максимальный объем фотографии: 5Мб

Время:
- Создание поста: 5 сек.
- Добавление оценки: 3 сек.
- Добавление комментария: 3 сек.
- Получение ленты постов: 1 сек.
- Получение комментариев поста: 2 сек.
- Получение фотографий поста: 3 сек.
- Получение оценки поста: 500 мс

#### Нагрузка

##### RPS

- Запросов на создание поста          = 1_000_000 * 1   / 86400 = 10
- Запросов на добавление фотографии   = 1_000_000 * 1   / 86400 = 10
- Запросов на добавление комментария  = 1_000_000 * 5   / 86400 = 50
- Запросов на оценку поста            = 1_000_000 * 10  / 86400 = 100
- Запросов на чтение поста            = 1_000_000 * (10 + 10) * 1  / 86400 = 200
- Запросов на чтение фотографии       = 1_000_000 * (10 + 10) * 1  / 86400 = 200
- Запросов на чтение комментариев     = 1_000_000 * (10 + 10) * 10 / 86400 = 2000
- Запросов на чтение оценок поста     = 1_000_000 * (10 + 10) * 1  / 86400 = 200

##### Схемы хранения данных

Пользователь:
- user_id 8b
- name 15b
- surname 20b
- lastname 15b
- description 100b

Total: 166b

Подписчики:
- user_id 8b
- subscriber_id 8b

Пост:
- post_id 8b
- user_id 8b
- place_id 8b
- created_at 8b
- description 100b

Total: 124b

Оценка поста:
- score_id 8b
- post_id 8b
- count 8b
- score 1b (1-10)

Для добавления нужен только post_id и score. 9b
Для чтения агрегируем по post_id и выводим среднюю. 8b
Total: 25b

Комментарий поста:
- comment_id 8b
- post_id 8b
- comment 100b

Total: 116b

Фотография поста:
- image_id 8b
- post_id 8b
- image 2Mb

Total: 2Mb

Место:
- place_id 8b
- name 100b 
- coordinate 16b
Total: 124b

##### Трафик

Write:
- Создание поста = 10 * 124 = 1 Kb/s
- Добавление фотографии = 10 * 2Mb= 2Mb/s
- Добавление комментариев = 50 * 116 = 5Kb/s
- Добавление оценки = 100 * 10 = 1Kb/s

Read:
- Чтение поста = 200 * 124 = 2 Kb/s
- Чтение картинок поста = 200 * 2Mb = 400Mb/s
- Чтение комментариев = 2000 * 116 = 220 Kb/s
- Чтение оценок = 200 * 8 = 1.6 Kb/s